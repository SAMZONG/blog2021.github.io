<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
    Wannacry蠕虫病毒事件及修复方案 - My New Hugo Site
</title>









<link rel="stylesheet" href="/sass/style.sass" integrity="" crossorigin="anonymous" media="screen">




  






<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Wannacry蠕虫病毒事件及修复方案"/>
<meta name="twitter:description" content="事件背景&nbsp;¶ 5月12日晚， WannaCry 蠕虫病毒在全球大肆爆发。据BBC、CNN等媒体报道，恶意攻击者利用 NSA（美国国家安全局）泄露的 Windows 0day 利用工具对99个国家实施了超过75000次攻击，主要影响SMB和RDP服务，主要影响了137、138、139、445端口。
目前已知已知的Windows版本包括但不限于一下都受影响：
 Windows NT Windows 2000 Windows XP Windows 2003 Windows Vista Windows 7 Windows 8 Windows 10 Windows 2008 Windows 2008 R2 Windows Server 2012 SP0  勒索者源头来自暗网，攻击具备兼容性、多语言支持，多个行业受到影响，国内高校网络系统沦为感染重灾区。据有关机构统计，目前国内每天有数万台机器遭到该蠕虫病毒袭击，国内的ATM机、火车站、自助终端、邮政、医院、政府办事终端、视频监控都可能遭受攻击。据报道，今日全国多地的中石油加油站无法进行网络支付，只能进行现金支付。中石油有关负责人表示，怀疑受到病毒攻击，具体情况还在核查。而截至目前，一些公安系统已经遭到入侵。
如果你也遇到了这样的问题，请不要担心，我在下面给出了如何修复这个漏洞的建议。
什么是比特币蠕虫病毒？&nbsp;¶ 这次攻击的始作俑者是一款名为“WannaCry”（中文名：想哭）的勒索病毒，带有加密功能，它利用 Windows 在 445 端口的安全漏洞潜入电脑并对多种文件类型加密并添加后缀(.onion)使用户无法打开，用户电脑存在文档被加密的情况，攻击者称需支付比特币解锁。(比特币是一种全球通用的互联网加密货币)
漏洞验证&nbsp;¶   使用Win&#43;R按键打开运行窗口，输入cmd，进入命令行工具，然后输入netstat -an查看是否开放了对应的端口。
上图中的服务器就是开放了445端口，这有很大的风险可能会WannaCry 蠕虫病毒被攻击到，所以我们应该关掉对应端口，并修复漏洞。
漏洞修复&nbsp;¶  目前微软已发布补丁MS17-010修复了“永恒之蓝”攻击的系统漏洞，请尽快为电脑安装此补丁，网址为https://technet.microsoft.com/zh-cn/library/security/MS17-010 对于XP、2003等微软已不再提供安全更新的机器，推荐使用360“NSA武器库免疫工具”检测系统是否存在漏洞，并关闭受到漏洞影响的端口，可以避免遭到勒索软件等病毒的侵害，可以在360电脑安全管家中找到。 开启系统防火墙，利用系统防火墙的“高级设置”阻止外部对 445 端口进的访问（存在一定影响，该操作会影响使用 445 端口的服务）。    修复脚本&nbsp;¶ 如果以上方式都不能修复漏洞，大家可以使用我以下的批处理脚本文件来尝试关闭端口及服务，批处理禁用该漏洞可能利用到的端口，全版本通用，右键管理员启动即可，注意这需要打开Windows的防火墙。
net stop SCardSvr net stop SCPolicySvc sc config SCardSvr start=disabled sc config SCPolicySvc start=disabled net start MpsSvc sc config MpsSvc start=auto netsh advfirewall set allprofiles state on netsh advfirewall firewall add rule name=&#34;deny udp 137&#34; dir=in protocol=udp localport=137 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 137&#34; dir=in protocol=tcp localport=137 action=block netsh advfirewall firewall add rule name=&#34;deny udp 138&#34; dir=in protocol=udp localport=138 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 138&#34; dir=in protocol=tcp localport=138 action=block netsh advfirewall firewall add rule name=&#34;deny udp 139&#34; dir=in protocol=udp localport=139 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 139&#34; dir=in protocol=tcp localport=139 action=block netsh advfirewall firewall add rule name=&#34;deny udp 445&#34; dir=in protocol=udp localport=445 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 445&#34; dir=in protocol=tcp localport=445 action=block pause 我已经将脚本上传到百度云盘中，大家可以自行下载运行，注意解压缩Zip包之后的fix_WannaCry."/>

<meta property="og:title" content="Wannacry蠕虫病毒事件及修复方案" />
<meta property="og:description" content="事件背景&nbsp;¶ 5月12日晚， WannaCry 蠕虫病毒在全球大肆爆发。据BBC、CNN等媒体报道，恶意攻击者利用 NSA（美国国家安全局）泄露的 Windows 0day 利用工具对99个国家实施了超过75000次攻击，主要影响SMB和RDP服务，主要影响了137、138、139、445端口。
目前已知已知的Windows版本包括但不限于一下都受影响：
 Windows NT Windows 2000 Windows XP Windows 2003 Windows Vista Windows 7 Windows 8 Windows 10 Windows 2008 Windows 2008 R2 Windows Server 2012 SP0  勒索者源头来自暗网，攻击具备兼容性、多语言支持，多个行业受到影响，国内高校网络系统沦为感染重灾区。据有关机构统计，目前国内每天有数万台机器遭到该蠕虫病毒袭击，国内的ATM机、火车站、自助终端、邮政、医院、政府办事终端、视频监控都可能遭受攻击。据报道，今日全国多地的中石油加油站无法进行网络支付，只能进行现金支付。中石油有关负责人表示，怀疑受到病毒攻击，具体情况还在核查。而截至目前，一些公安系统已经遭到入侵。
如果你也遇到了这样的问题，请不要担心，我在下面给出了如何修复这个漏洞的建议。
什么是比特币蠕虫病毒？&nbsp;¶ 这次攻击的始作俑者是一款名为“WannaCry”（中文名：想哭）的勒索病毒，带有加密功能，它利用 Windows 在 445 端口的安全漏洞潜入电脑并对多种文件类型加密并添加后缀(.onion)使用户无法打开，用户电脑存在文档被加密的情况，攻击者称需支付比特币解锁。(比特币是一种全球通用的互联网加密货币)
漏洞验证&nbsp;¶   使用Win&#43;R按键打开运行窗口，输入cmd，进入命令行工具，然后输入netstat -an查看是否开放了对应的端口。
上图中的服务器就是开放了445端口，这有很大的风险可能会WannaCry 蠕虫病毒被攻击到，所以我们应该关掉对应端口，并修复漏洞。
漏洞修复&nbsp;¶  目前微软已发布补丁MS17-010修复了“永恒之蓝”攻击的系统漏洞，请尽快为电脑安装此补丁，网址为https://technet.microsoft.com/zh-cn/library/security/MS17-010 对于XP、2003等微软已不再提供安全更新的机器，推荐使用360“NSA武器库免疫工具”检测系统是否存在漏洞，并关闭受到漏洞影响的端口，可以避免遭到勒索软件等病毒的侵害，可以在360电脑安全管家中找到。 开启系统防火墙，利用系统防火墙的“高级设置”阻止外部对 445 端口进的访问（存在一定影响，该操作会影响使用 445 端口的服务）。    修复脚本&nbsp;¶ 如果以上方式都不能修复漏洞，大家可以使用我以下的批处理脚本文件来尝试关闭端口及服务，批处理禁用该漏洞可能利用到的端口，全版本通用，右键管理员启动即可，注意这需要打开Windows的防火墙。
net stop SCardSvr net stop SCPolicySvc sc config SCardSvr start=disabled sc config SCPolicySvc start=disabled net start MpsSvc sc config MpsSvc start=auto netsh advfirewall set allprofiles state on netsh advfirewall firewall add rule name=&#34;deny udp 137&#34; dir=in protocol=udp localport=137 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 137&#34; dir=in protocol=tcp localport=137 action=block netsh advfirewall firewall add rule name=&#34;deny udp 138&#34; dir=in protocol=udp localport=138 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 138&#34; dir=in protocol=tcp localport=138 action=block netsh advfirewall firewall add rule name=&#34;deny udp 139&#34; dir=in protocol=udp localport=139 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 139&#34; dir=in protocol=tcp localport=139 action=block netsh advfirewall firewall add rule name=&#34;deny udp 445&#34; dir=in protocol=udp localport=445 action=block netsh advfirewall firewall add rule name=&#34;deny tcp 445&#34; dir=in protocol=tcp localport=445 action=block pause 我已经将脚本上传到百度云盘中，大家可以自行下载运行，注意解压缩Zip包之后的fix_WannaCry." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/wannacry%E8%A0%95%E8%99%AB%E7%97%85%E6%AF%92%E4%BA%8B%E4%BB%B6%E5%8F%8A%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88/" /><meta property="article:section" content="posts" />





    

    
    
    
    <title>
        
        Wannacry蠕虫病毒事件及修复方案
        
    </title>
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>Wannacry蠕虫病毒事件及修复方案</h1>
    </header>
    
    <main class="wrap">
        
<div class="flex-container">
    <aside role="complementary">
        Mon Jan 01, 0001 &#183; 194 words
        <div class="tag-container">
            
        </div>
    </aside>
    <hr />
    <article role="article">
        <p><p style="text-align:center;">
    <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/3d0jo.png" alt=""  />
</p>
</p>

<h3 id="事件背景" class="anchor-link"><a href="#%e4%ba%8b%e4%bb%b6%e8%83%8c%e6%99%af">事件背景<span class="pilcrow">&nbsp;¶</span></a></h3>
<p>5月12日晚， WannaCry 蠕虫病毒在全球大肆爆发。据BBC、CNN等媒体报道，恶意攻击者利用 NSA（美国国家安全局）泄露的 Windows 0day 利用工具对99个国家实施了超过75000次攻击，主要影响SMB和RDP服务，主要影响了137、138、139、445端口。</p>
<p>目前已知已知的Windows版本包括但不限于一下都受影响：</p>
<ul>
<li>Windows NT</li>
<li>Windows 2000</li>
<li>Windows XP</li>
<li>Windows 2003</li>
<li>Windows Vista</li>
<li>Windows 7</li>
<li>Windows 8</li>
<li>Windows 10</li>
<li>Windows 2008</li>
<li>Windows 2008 R2</li>
<li>Windows Server 2012 SP0</li>
</ul>
<p>勒索者源头来自暗网，攻击具备兼容性、多语言支持，多个行业受到影响，国内高校网络系统沦为感染重灾区。据有关机构统计，目前国内每天有数万台机器遭到该蠕虫病毒袭击，国内的ATM机、火车站、自助终端、邮政、医院、政府办事终端、视频监控都可能遭受攻击。据报道，今日全国多地的中石油加油站无法进行网络支付，只能进行现金支付。中石油有关负责人表示，怀疑受到病毒攻击，具体情况还在核查。而截至目前，一些公安系统已经遭到入侵。</p>
<p>如果你也遇到了这样的问题，请不要担心，我在下面给出了如何修复这个漏洞的建议。</p>
<p><p style="text-align:center;">
    <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9y7cc.jpg" alt=""  />
</p>
</p>

<h3 id="什么是比特币蠕虫病毒" class="anchor-link"><a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%af%94%e7%89%b9%e5%b8%81%e8%a0%95%e8%99%ab%e7%97%85%e6%af%92">什么是比特币蠕虫病毒？<span class="pilcrow">&nbsp;¶</span></a></h3>
<p>这次攻击的始作俑者是一款名为“WannaCry”（中文名：想哭）的勒索病毒，带有加密功能，它利用 Windows 在 445 端口的安全漏洞潜入电脑并对多种文件类型加密并添加后缀(.onion)使用户无法打开，用户电脑存在文档被加密的情况，攻击者称需支付比特币解锁。(比特币是一种全球通用的互联网加密货币)</p>

<h3 id="漏洞验证" class="anchor-link"><a href="#%e6%bc%8f%e6%b4%9e%e9%aa%8c%e8%af%81">漏洞验证<span class="pilcrow">&nbsp;¶</span></a></h3>
<ol>
<li>
<p>使用<!-- raw HTML omitted -->Win<!-- raw HTML omitted -->+<!-- raw HTML omitted -->R<!-- raw HTML omitted -->按键打开运行窗口，输入cmd，进入命令行工具，然后输入<!-- raw HTML omitted -->netstat -an<!-- raw HTML omitted --> 查看是否开放了对应的端口。</p>
<p><p style="text-align:center;">
    <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/3m1jm.png" alt=""  />
</p>
</p>
<p>上图中的服务器就是开放了445端口，这有很大的风险可能会WannaCry 蠕虫病毒被攻击到，所以我们应该关掉对应端口，并修复漏洞。</p>

<h3 id="漏洞修复" class="anchor-link"><a href="#%e6%bc%8f%e6%b4%9e%e4%bf%ae%e5%a4%8d">漏洞修复<span class="pilcrow">&nbsp;¶</span></a></h3>
<ol>
<li>目前微软已发布补丁MS17-010修复了“永恒之蓝”攻击的系统漏洞，请尽快为电脑安装此补丁，网址为<a href="https://laod.cn/go.php?url=https://technet.microsoft.com/zh-cn/library/security/MS17-010">https://technet.microsoft.com/zh-cn/library/security/MS17-010</a></li>
<li>对于XP、2003等微软已不再提供安全更新的机器，推荐使用360“NSA武器库免疫工具”检测系统是否存在漏洞，并关闭受到漏洞影响的端口，可以避免遭到勒索软件等病毒的侵害，可以在360电脑安全管家中找到。</li>
<li>开启系统防火墙，利用系统防火墙的“高级设置”阻止外部对 445 端口进的访问（存在一定影响，该操作会影响使用 445 端口的服务）。</li>
</ol>
</li>
</ol>

<h3 id="修复脚本" class="anchor-link"><a href="#%e4%bf%ae%e5%a4%8d%e8%84%9a%e6%9c%ac">修复脚本<span class="pilcrow">&nbsp;¶</span></a></h3>
<p>如果以上方式都不能修复漏洞，大家可以使用我以下的批处理脚本文件来尝试关闭端口及服务，批处理禁用该漏洞可能利用到的端口，全版本通用，右键管理员启动即可，注意这需要打开Windows的防火墙。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">net stop SCardSvr
net stop SCPolicySvc
sc config SCardSvr start<span style="color:#f92672">=</span>disabled
sc config SCPolicySvc start<span style="color:#f92672">=</span>disabled
net start MpsSvc
sc config MpsSvc start<span style="color:#f92672">=</span>auto
netsh advfirewall set allprofiles state on
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny udp 137&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>udp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">137</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny tcp 137&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>tcp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">137</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny udp 138&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>udp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">138</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny tcp 138&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>tcp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">138</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny udp 139&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>udp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">139</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny tcp 139&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>tcp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">139</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny udp 445&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>udp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">445</span> action<span style="color:#f92672">=</span>block
netsh advfirewall firewall add rule name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deny tcp 445&#34;</span> dir<span style="color:#f92672">=</span>in protocol<span style="color:#f92672">=</span>tcp localport<span style="color:#f92672">=</span><span style="color:#ae81ff">445</span> action<span style="color:#f92672">=</span>block
pause
</code></pre></div><p>我已经将脚本上传到百度云盘中，大家可以自行下载运行，注意解压缩Zip包之后的fix_WannaCry.bat</p>
<p>下载链接：https://pan.baidu.com/s/1gfceNRH</p>

<h3 id="添加防火规则" class="anchor-link"><a href="#%e6%b7%bb%e5%8a%a0%e9%98%b2%e7%81%ab%e8%a7%84%e5%88%99">添加防火规则<span class="pilcrow">&nbsp;¶</span></a></h3>
<ol>
<li>
<p>打开控制面板中的Windows防火墙，并保证防火墙处于启用状态；</p>
</li>
<li>
<p>打开防火墙的高级设置；</p>
</li>
<li>
<p>在“入站规则”中新建一条规则，本地端口号选择445，操作选择阻止连接。</p>
<p><p style="text-align:center;">
    <img src="https://pic3.zhimg.com/v2-85f14330cdba1fbf89369b26b9e48f52_b.png" alt=""  />
</p>
</p>
<p><p style="text-align:center;">
    <img src="https://pic2.zhimg.com/v2-1bbe08395ec8ef8d0e2028cbccb01055_b.png" alt=""  />
</p>
</p>
</li>
</ol>

<h3 id="手动导入安全策略" class="anchor-link"><a href="#%e6%89%8b%e5%8a%a8%e5%af%bc%e5%85%a5%e5%ae%89%e5%85%a8%e7%ad%96%e7%95%a5">手动导入安全策略<span class="pilcrow">&nbsp;¶</span></a></h3>
<p>下载策略文件</p>
<p><a href="https://share.weiyun.com/15b7bbd3f86c493a66721dd948a81c54">https://share.weiyun.com/15b7bbd3f86c493a66721dd948a81c54</a></p>
<p>打开控制面板&ndash;管理工具-本地安全策略&ndash;IP安全策略 &ndash;&gt;所有任务&ndash;&gt;导入策略：</p>
<p><p style="text-align:center;">
    <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/hj9f4.jpg" alt=""  />
</p>
</p>
<p>或者，通过<!-- raw HTML omitted -->Win<!-- raw HTML omitted -->+<!-- raw HTML omitted -->R<!-- raw HTML omitted -->，输入<!-- raw HTML omitted -->gpedit.msc<!-- raw HTML omitted --></p>
<p><p style="text-align:center;">
    <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9vsqx.jpg" alt=""  />
</p>
</p>
<p><p style="text-align:center;">
    <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/tosjk.jpg" alt=""  />
</p>
</p>
<p>![539E3FA1-2A85-4B41-95BC-C32B82A5DA0D](/Users/Alex/Library/Containers/com.tencent.qq/Data/Library/Application Support/QQ/Users/573578678/QQ/Temp.db/539E3FA1-2A85-4B41-95BC-C32B82A5DA0D.png)</p>

    </article>
</div>


        
<nav role="navigation" class="flex-container bottom-menu">
    
<hr />
<p>


    
        <a href="/posts">back</a>
        
    

    
</p>
</nav>

    </main>
    
    <footer class="flex-container footer">
</footer>
    
    
</body>

</html>