<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.88.1" />

  <title>HowTo Use Docker create a Tomcat Project &middot; SAMZONG</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="HowTo Use Docker create a Tomcat Project">
<meta itemprop="description" content="1. 安装CentOS 7.x 略。  2. 安装docker 详见： How to Install Docker on CentOS 6."><meta itemprop="datePublished" content="2016-08-02T15:44:20+00:00" />
<meta itemprop="dateModified" content="2016-08-02T15:44:20+00:00" />
<meta itemprop="wordCount" content="806">
<meta itemprop="keywords" content="Docker," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HowTo Use Docker create a Tomcat Project"/>
<meta name="twitter:description" content="1. 安装CentOS 7.x 略。  2. 安装docker 详见： How to Install Docker on CentOS 6."/>


<meta property="og:title" content="HowTo Use Docker create a Tomcat Project" />
<meta property="og:description" content="1. 安装CentOS 7.x 略。  2. 安装docker 详见： How to Install Docker on CentOS 6." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/posts/howto-use-docker-create-a-tomcat-project/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-08-02T15:44:20+00:00" />
<meta property="article:modified_time" content="2016-08-02T15:44:20+00:00" />




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type":"Person",
      "@id": "https://example.com#author",
      "name": "samzong.lu",
      "image": {
        "@type":"ImageObject",
        "url": "https://www.gravatar.com/avatar/c02c426714361366ea7d583950aa8fb4?s=400&d=mp"
      },
      "description": "Samzong's Blog"
    },
    {
      "@type": "WebSite",
      "@id": "https://example.com#website",
      "url": "https://example.com",
      "name": "SAMZONG",
      "description": "Samzong's Blog",
      "publisher": {
        "@id": "https://example.com#author"
      },
      "inLanguage": "zh-CN"
    },
    {
      "@type": "WebPage",
      "@id": "https://example.com/posts/howto-use-docker-create-a-tomcat-project/#webpage",
      "url": "https://example.com/posts/howto-use-docker-create-a-tomcat-project/",
      "name": "HowTo Use Docker create a Tomcat Project",
      "isPartOf": {
        "@id": "https://example.com#website"
      },
      "about": {
         "@id": "https://example.com#author"
      },
      "datePublished": "2016-08-02T15:44:20+00:00",
      "dateModified": "2016-08-02T15:44:20+00:00",
      "description": "1. 安装CentOS 7.x 略。  2. 安装docker 详见： How to Install Docker on CentOS 6.",
      "inLanguage": "zh-CN",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": [
            "https://example.com/posts/howto-use-docker-create-a-tomcat-project/"
          ]
        }
      ]
    },
    {
      "@type": "Article",
      "isPartOf": {
        "@id": "https://example.com/posts/howto-use-docker-create-a-tomcat-project/#webpage"
      },
      "mainEntityOfPage": {
        "@id": "https://example.com/posts/howto-use-docker-create-a-tomcat-project/#webpage"
      },
      "headline": "HowTo Use Docker create a Tomcat Project",
      "datePublished": "2016-08-02T15:44:20+00:00",
      "dateModified": "2016-08-02T15:44:20+00:00",
      "publisher": {
        "@id": "https://example.com#author"
      },
      "keywords": [
        "Docker"
      ],
      "articleSection": [
        "Docker"
      ],
      "inLanguage": "zh-CN",
      "author": {
        "@type": "Person",
        "name":  null 
      },
      "potentialAction": [
        {
          "@type": "CommentAction",
          "name": "Comment",
          "target": [
            "https://example.com/posts/howto-use-docker-create-a-tomcat-project/#comments"
          ]
        }
      ]
    }
  ]
}
</script>



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  <link type="text/css" rel="stylesheet" href="/css/blog.css">

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
      <div class="author-image">
        <a href="https://example.com">
          <img src="https://www.gravatar.com/avatar/c02c426714361366ea7d583950aa8fb4?s=200&d=mp" class="img-circle img-headshot center" alt="Gravatar">
        </a>
      </div>
      

      <h1>SAMZONG</h1>

      
      <p class="lead">Samzong&#39;s Blog</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://example.com">Home</a>
        </li>
        <li>
          <a href="/posts/">Posts</a>
        </li><li>
          <a href="/about/">About</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://www.linkedin.com/in/samzong/" rel="me" title="Linkedin" target="_blank">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/samzong" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/samzong_lu" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1 class="title">HowTo Use Docker create a Tomcat Project</h1>
  

  <div class="post-date">
    <time datetime="2016-08-02T15:44:20Z">Aug 2, 2016</time> <span class="readtime">&middot; 4 min read</span>
  </div>

  <div>
  <h4 id="1-安装centos-7x"><strong>1. 安装CentOS 7.x</strong></h4>
<pre><code>略。
</code></pre>
<h4 id="2-安装docker"><strong>2. 安装docker</strong></h4>
<p>详见： <a href="http://samzong.me/2016/07/07/how-to-install-docker-on-centos-6-x-2/">How to Install Docker on CentOS 6.x</a></p>
<h4 id="3-基础docker命令"><strong>3. 基础docker命令</strong></h4>
<pre tabindex="0"><code>＃ 获取centos6 docker镜像
[root@docker ~]# docker pull centos6
Using default tag: latest
latest: Pulling from library/centos:centos6

43db9dbdcb30: Downloading 41.14 MB/49.33 MB
43db9dbdcb30: Pull complete
2dc64e8f8d4f: Pull complete
670a583e1b50: Pull complete
183b0bfcd10e: Pull complete
Digest: sha256:c6674c44c6439673bf56536c1a15916639c47ea04c3d6296c5df938add67b54b
Status: Downloaded newer image for centso:centos6

＃ 查看当前服务器上的docker镜像
[root@docker ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
centos6-visionet    latest              aeed37612ecb        6 hours ago         1.916 GB
centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
registry            latest              c6c14b3960bd        3 days ago          33.28 MB
＃ 查找docker镜像
[root@docker ~]# docker search centos:centos6
NAME                                     DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
imagine10255/centos6-lnmp-php56          centos6-lnmp-php56                              10                   [OK]
lemonbar/centos6-ssh                     Installed openssh-server on centos6, defau...   7                    [OK]
sergeyzh/centos6-nginx                                                                   2                    [OK]
guyton/centos6                           From official centos6 container with full ...   2                    [OK]
paijp/centos6-apache-php-sqlite2         php5.3.3 with sqlite2 and apache on CentOS...   1                    [OK]
edrans/centos6                                                                           1                    [OK]
mohri1219/centos6.7-ruby2.2.2-mysql5.6   centos6.7-ruby2.2.2-mysql5.6                    1                    [OK]
...
...

＃ 删除 centos6 docker镜像
[root@docker ~]# docker rmi IMAGES_NAME
[root@docker ~]# docker rmi centos:centos6
# 报错无法删除
Error response from daemon: conflict: unable to remove repository reference &quot;centos&quot; (must force) - container 705a30cbc002 is using its referenced image 42118e3df429
# 这是因为之间的运行的进程没有清楚导致该images正在使用中，使用一下命令查看占有的进程
[root@docker ~]# docker ps -a ＃ 查看所有的docker进程
CONTAINER ID        IMAGE               COMMAND               CREATED             STATUS                     PORTS               NAMES
705a30cbc002        centos:centos6              &quot;/bin/bash&quot;           6 minutes ago       Exited (0) 6 minutes ago                       centos6
[root@docker ~]# docker rm 705a30cbc002
705a30cbc002
[root@docker ~]# docker rmi centos:centos6
Untagged: centos:centos6
Deleted: sha256:42118e3df429f09ca581a9deb3df274601930e428e452f7e4e9f1833c56a100a
Deleted: sha256:d72d0199021776e77ac14a764a3decd156e9f6f18b37e25b867b0f1ca42fb3d9
Deleted: sha256:fb178c6cea1453d089ce033b96eba0efdb42274138e042517ea2d5ea7bb51665
Deleted: sha256:8945af30572845a904adce2aeaf73402c842d86e99e8f10688b25cb27834110b
Deleted: sha256:ea9f151abb7e06353e73172dad421235611d4f6d0560ec95db26e0dc240642c1
</code></pre><h4 id="4-运行一个docker镜像"><strong>4. 运行一个docker镜像</strong></h4>
<h4 id="进入交互式程序">进入交互式程序</h4>
<pre tabindex="0"><code>[root@docker ~]# docker run  -it centos:centos6 /bin/bash
[root@c1d190f95562 /]# cat /etc/redhat-release
CentOS release 6.8 (Final)
# Install openssh-server and httpd
root@d8c122dbe09d:/# yum install -y openssh-sever httpd
root@d8c122dbe09d:/# exit

# 注意当你执行exit，从容器之中退出时，容器也会随着关闭，这时如果还继续执行上条命令
# 你会发现之前所有的操作都被还原，因为相对于docker，又是新开了一个进程
# 在exit退出之后，使用一下命令查看上次提交，然后commit修改，便可保存之前的修改

[root@docker ~]# docker ps -l
[root@docker ~]# docker commit c1d190f95562 centos:centos6-httpd
sha256:77eb12e36c7bbe9ef874555b1873019022b5258740aa731627e2cd6fa749c325
[root@docker ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
centos              centos6-httpd       77eb12e36c7b        3 seconds ago       290.3 MB
centos6-visionet    latest              aeed37612ecb        6 hours ago         1.916 GB
centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
registry            latest              c6c14b3960bd        3 days ago          33.28 MB
</code></pre><h4 id="5-编辑dockerfile"><strong>5. 编辑Dockerfile</strong></h4>
<pre tabindex="0"><code># dockfile的第一行一定是FROM，指定了父镜像
FROM centos:centos6

# RUN 指的是运行的命令
RUN yum install -y epel-release
RUN yum install -y bash-completion
RUN yum install -y openssh-server openssh-client sudo
RUN sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config
RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

# 增加一个用户，并赋予sudo权限
RUN useradd visionet
RUN echo &quot;visionet:visionet&quot; | chpasswd
RUN echo &quot;visionet   ALL=(ALL)       ALL&quot; &gt;&gt; /etc/sudoers

＃ 注意，如果没有执行一下两个命令，sshd是无法远程登陆的
RUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key

＃ EXPOSE 22， 将22端口暴露出来，方便ssh远程连接
RUN mkdir /var/run/sshd
EXPOSE 22
＃ CMD 为系统内部执行命令
CMD [&quot;/usr/sbin/sshd&quot;, &quot;-D&quot;]
</code></pre><h4 id="6-生成自定义docker镜像"><strong>6. 生成自定义docker镜像</strong></h4>
<pre tabindex="0"><code># build 编译镜像
[root@docker ~]# docker build -f dockerfile3 -t centos:centos6-ssh .
Sending build context to Docker daemon 44.54 kB
Step 1 : FROM centos:centos6
 ---&gt; a3c09d36ab4a
Step 2 : RUN yum install -y epel-release
 ---&gt; Using cache
 ---&gt; 04d81f280a63
Step 3 : RUN yum install -y bash-completion
 ---&gt; Using cache
 ---&gt; 5ca26894dc9d
Step 4 : RUN yum install -y openssh-server openssh-client sudo
 ---&gt; Using cache
 ---&gt; 42278450311e
Step 5 : RUN sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config
 ---&gt; Using cache
 ---&gt; db35bef562a2
Step 6 : RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
 ---&gt; Using cache
 ---&gt; dc9f2b82e198
Step 7 : RUN useradd visionet
 ---&gt; Using cache
 ---&gt; 06c574a51755
Step 8 : RUN echo &quot;visionet:visionet&quot; | chpasswd
 ---&gt; Using cache
 ---&gt; 03412f053d04
Step 9 : RUN echo &quot;visionet   ALL=(ALL)       ALL&quot; &gt;&gt; /etc/sudoers
 ---&gt; Using cache
 ---&gt; bf8476812a62
Step 10 : RUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
 ---&gt; Using cache
 ---&gt; 2314cce75171
Step 11 : RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
 ---&gt; Using cache
 ---&gt; 99304cd9ac15
Step 12 : RUN mkdir /var/run/sshd
 ---&gt; Using cache
 ---&gt; f87283751553
Step 13 : EXPOSE 22
 ---&gt; Using cache
 ---&gt; 56c41202dcb9
Step 14 : CMD /usr/sbin/sshd -D
 ---&gt; Using cache
 ---&gt; d6dccb483fa6
Successfully built d6dccb483fa6
[root@docker ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
centos              centos6-ssh         d6dccb483fa6        2 minutes ago         363 MB
centos              centos6-httpd       77eb12e36c7b        6 minutes ago       290.3 MB
centos6-visionet    latest              aeed37612ecb        6 hours ago         1.916 GB
centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
registry            latest              c6c14b3960bd        3 days ago          33.28 MB

# 后台运行docker容器，并指定nat端口转发
[root@docker ~]# docker run -d -p 2222:22 -P --name=sshd centos:centos6-ssh
b4211f7a304d9e34b72b510230be2c7a76b276886b488f08f3e12896a4d3c172

</code></pre><h4 id="7-ssh登陆到docker容器内部署项目环境"><strong>7. ssh登陆到docker容器内，部署项目环境</strong></h4>
<pre tabindex="0"><code># inspect 查看docker 容器IP地址
[root@docker ~]# docker inspect sshd | grep IPAddress
[root@docker ~]# ssh visionet@172.17.0.2
visionet@172.17.0.2's password:
[visionet@b4211f7a304d ~]$

# Install mysql
# Install tomcat server

[visionet@b4211f7a304d ~]$ exit
[root@docker ~]# docker stop sshd
sshd
[root@docker ~]# docker ps -l
CONTAINER ID        IMAGE                COMMAND               CREATED             STATUS                       PORTS               NAMES
b4211f7a304d        centos:centos6-ssh   &quot;/usr/sbin/sshd -D&quot;   6 minutes ago       Exited (255) 3 seconds ago                       sshd
[root@docker ~]# docker commit b4211f7a304d centos:centos6-tomcat
sha256:b4f114d5484822d9a3ddf1100b76b460985ba5e5d31e936570e8d7dbd8df282c
[root@docker ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
centos              centos6-tomcat      b4f114d54848        4 seconds ago       363.1 MB
centos              centos6-httpd       77eb12e36c7b        15 minutes ago      290.3 MB
centos6-visionet    latest              aeed37612ecb        7 hours ago         1.916 GB
centos              centos6-ssh         d6dccb483fa6        9 hours ago         363 MB
centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
registry            latest              c6c14b3960bd        3 days ago          33.28 MB

</code></pre><h4 id="8-推送centoscentos6-tomcat到私有docker仓库"><strong>8. 推送centos:centos6-tomcat到私有docker仓库</strong></h4>

  </div>

  
<div>
  <ul class="tags">
  <li>
    <a href="https://example.com/tags/docker/" class="tag-link">Docker</a>
  </li>
  </ul>
</div>



  <div class="share-buttons">
  <a class="twitter-share-button"
     href="#"
     title="Share on Twitter"
     data-url="https://example.com/posts/howto-use-docker-create-a-tomcat-project/"
     data-text="HowTo Use Docker create a Tomcat Project"><i class="fab fa-twitter"></i></a>

  <a class="linkedin-share-button"
     href="#"
     title="Share on LinkedIn"
     data-url="https://example.com/posts/howto-use-docker-create-a-tomcat-project/"
     data-text="HowTo Use Docker create a Tomcat Project"><i class="fab fa-linkedin-in"></i></a>

  <a class="facebook-share-button"
     href="#"
     title="Share on Facebook"
     data-url="https://example.com/posts/howto-use-docker-create-a-tomcat-project/"
     data-text="HowTo Use Docker create a Tomcat Project"><i class="fab fa-facebook"></i></a>

  <a class="telegram-share-button"
     href="#"
     title="Share on Telegram"
     data-url="https://example.com/posts/howto-use-docker-create-a-tomcat-project/"
     data-text="HowTo Use Docker create a Tomcat Project"><i class="fab fa-telegram"></i></a>

  <a class="pinterest-share-button"
     href="#"
     title="Share on Pinterest"
     data-url="https://example.com/posts/howto-use-docker-create-a-tomcat-project/"
     data-text="HowTo Use Docker create a Tomcat Project"><i class="fab fa-pinterest"></i></a>
</div>


  
</div>
  </main>

  <footer>
  <div>
    <p>
      &copy; samzong.lu 2021

      &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

      
    </p>
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>


  <script src="/js/jquery.min.js"></script>
  <script src="/js/soho.js"></script>

  <script src="/js/blog.js"></script>

  
</body>
</html>
